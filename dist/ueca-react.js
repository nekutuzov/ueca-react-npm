import{jsx as t,Fragment as e}from"react/jsx-runtime";import*as i from"react";import*as n from"mobx";import*as s from"mobx-react";function r(t){if(t){return JSON.parse(JSON.stringify(t))}}function a(t){return void 0===t}function o(t){return null===t}function c(t){return"string"==typeof t}function h(t){return"number"==typeof t}function u(t){return"boolean"==typeof t}function d(t){return Array.isArray(t)}function l(t){return"function"==typeof t}function _(t){return null!==t&&"object"==typeof t}function m(t){return t instanceof Map}function p(t){return"symbol"==typeof t}function g(t,e){if(t===e){return!0}if(_(t)&&_(e)){const i=Object.keys(t),n=Object.keys(e);if(i.length!==n.length){return!1}for(const s of i){if(!n.includes(s)||!g(t[s],e[s])){return!1}}return!0}return!1}function f(t,e){return t.filter(t=>e.includes(t))}function b(i){return i.condition?t(e,{children:$(i.children)}):null}function $(e){if(l(e)){const i=s.observer(e);
return t(i,{})}return Y(e)?t(e,{}):e}const v=s.observer(i=>!1===i.render?null:t(e,{children:$(i.node)}));function w(t,e="Invalid condition"){if(t){throw Error(e)}}function y(t,e){if(!t){throw Error(e||"Invalid condition")}}async function C(t){await new Promise(e=>setTimeout(e,t))}function M(t){return l(t)?s.observer(t):n.observable(t)}function k(t){return!!(t&&_(t)&&2===Object.keys(t).length&&l(t[0])&&(l(t[1])||a(t[1])))}function R(t){return k(t)&&l(t[1])}function O(t,e){return[()=>{let i;try{i=t()}catch(n){ot(n.message,"error")}return i||ot(`Attempt to get bound property "${e.toString()}" of undefined`,"warn"),i?i[e]:void 0},i=>{let n;try{n=t()}catch(s){ot(s.message,"error")}n?n[e]=i:ot(`Attempt to set bound property "${e.toString()}" of undefined`,"warn")}]}function P(t,e){if(l(t)&&(l(e)||void 0===e)){return[(i=t)?()=>{let t;try{t=i()}catch(e){ot(e.message,"error")}return t}:void 0,(n=e)?t=>{try{n(t)}catch(e){ot(e.message,"error")}}:void 0]}var i,n;if(l(t)&&c(e)){return O(t,e)}throw new Error("Invalid arguments for bind()")}class I{_target;_name;constructor(t,e){this._target=t,this._name=e}}class B extends I{_observableKind=0;_value=void 0;_valueShallow=void 0;_valueRef=void 0;_forceReactionToggle=void 0;_onValueChangeReactionDisposer;_structBindingReactionDisposer;_paramsBindingReactionDisposer;constructor(t,e){super(t,e),n.makeObservable(this,{_value:n.observable,_valueShallow:n.observable.shallow,_valueRef:n.observable.ref,_forceReactionToggle:n.observable.ref,_forceReaction:n.action})}initBindings(){this._setupOnValueChangeReaction(),this._setupStructBindingReaction(),this._setupParamsBindingReaction()}deinitBindings(){this._onValueChangeReactionDisposer?.(),this._onValueChangeReactionDisposer=void 0,this._structBindingReactionDisposer?.(),this._structBindingReactionDisposer=void 0,this._paramsBindingReactionDisposer?.(),this._paramsBindingReactionDisposer=void 0}get value(){return this._getObservable()}set value(t){if(k(t)){throw Error("Attempt to assign binding as a value")}n.runInAction(()=>{this._paramsBinding||this._structBinding?this._modelIsNew()?this._setValue(t):(this._structBinding&&R(this._structBinding)&&(this._structBinding[1]?.(t),t=this._structBinding[0]?.()),this._paramsBinding&&R(this._paramsBinding)&&this._paramsBinding[1]?.(t)):this._setValue(t)})}_setValue(t){let e=this._getObservable();d(e)&&(e=e.slice());const i=this._target;if(!B._isEqual(t,e)){if(!this._modelIsNew()&&!i.changeNotifyDisabled()){const i=this._name;this._structOnPropChanging&&w((t=this._structOnPropChanging(i,t,e))instanceof Promise,"Asynchronous OnPropChanging event is not allowed");let n=this._getStructOnChangingEvent(i);if(n&&w((t=n(t,e))instanceof Promise,"Asynchronous OnChanging<Prop> event is not allowed"),this._customOnPropChanging&&w((t=this._customOnPropChanging(i,t,e))instanceof Promise,"Asynchronous OnPropChanging event is not allowed"),n=this._getCustomOnChangingEvent(i),n&&w((t=n(t,e))instanceof Promise,"Asynchronous OnChanging<Prop> event is not allowed"),B._isEqual(t,e)){return void setTimeout(()=>this._forceReaction())}}this._setObservable(t)}}_setupStructBindingReaction(){if(this._structBindingReactionDisposer?.(),this._structBindingReactionDisposer=void 0,!this._structBinding){return}const t=this._name,e=this._target,i=i=>{try{i=this._structBinding[0](),this._paramsBindingReactionDisposer&&R(this._paramsBinding)&&(this._paramsBinding[1](i),i=this._paramsBinding[0]()),this._setValue(i)}catch(n){ot(`Struct binding error: ${t}.set(${X(i)}) model=#${e.birthMark()} path=${e.htmlId()}\n${n}`,"error")}};this._structBindingReactionDisposer=n.reaction(()=>{let t=this._structBinding[0]();return d(t)&&(t=t.slice()),[t,this._forceReactionToggle]},([t])=>i(t),{name:`Struct binding model=#${e.birthMark()} path=${e.htmlId()}.${t}`,fireImmediately:!0})}_setupParamsBindingReaction(){if(this._paramsBindingReactionDisposer?.(),this._paramsBindingReactionDisposer=void 0,!this._paramsBinding){return}const t=this._name,e=this._target,i=i=>{try{this._structBindingReactionDisposer&&R(this._structBinding)&&(this._structBinding[1](i),i=this._structBinding[0]()),this._setValue(i)}catch(n){ot(`Param binding error: ${t}.set(${X(i)}) model=#${e.birthMark()} path=${e.htmlId()}${n}`,"error")}};this._paramsBindingReactionDisposer=n.reaction(()=>{let t=this._paramsBinding[0]();return d(t)&&(t=t.slice()),[t,this._forceReactionToggle]},([t])=>i(t),{name:`Param binding model=#${e.birthMark()} path=${e.htmlId()}.${t}`,fireImmediately:!0})}_setupOnValueChangeReaction(){this._onValueChangeReactionDisposer?.(),this._onValueChangeReactionDisposer=void 0;const t=this._name,e=this._target;this._onValueChangeReactionDisposer=n.reaction(()=>{let t=this._getObservable();return d(t)&&(t=t.slice()),[t,this._forceReactionToggle]},([i],[n])=>{try{if(this._modelIsNew()){throw Error("???")}if(B._isEqual(i,n)){return}ot(`change prop model=#${e.birthMark()} path=${e.htmlId()}[${t}] ${X(n)}➝${X(i)}`),e.changeNotifyDisabled()||(this._structOnPropChange?.(t,i,n),this._getStructOnChangeEvent(t)?.(i,n),this._customOnPropChange?.(t,i,n),this._getCustomOnChangeEvent(t)?.(i,n))}catch(s){ot(`Prop change error: ${t}.set(${X(i)}) model=#${e.birthMark()} path=${e.htmlId()}\n${s}`,"error")}},{name:`Prop change model=#${e.birthMark()} path=${e.htmlId()}.${t}`})}get _structBinding(){const t=this._name,e=this._target;if(k(e.$.__struct.props?.[t])){return e.$.__struct.props[t]}}get _paramsBinding(){const t=this._name,e=this._target;if(k(e.$.__params?.[t])){return e.$.__params[t]}}get _structOnPropChanging(){return this._target.$.__struct.events?.onPropChanging}get _structOnPropChange(){return this._target.$.__struct.events?.onPropChange}_getStructOnChangingEvent(t){return this._target.$.__struct.events?.[`onChanging${tt(t)}`]}_getStructOnChangeEvent(t){return this._target.$.__struct.events?.[`onChange${tt(t)}`]}get _customOnPropChanging(){const t=this._target.onPropChanging;if(t instanceof V){return t.event}}get _customOnPropChange(){const t=this._target.onPropChange;if(t instanceof V){return t.event}}_getCustomOnChangingEvent(t){const e=this._target[`onChanging${tt(t)}`];if(e instanceof V){return e.event}}_getCustomOnChangeEvent(t){const e=this._target[`onChange${tt(t)}`];if(e instanceof V){return e.event}}_modelIsNew(){return!this._target.$.__status.initPhase}_forceReaction(){this._forceReactionToggle=!this._forceReactionToggle}_getObservable(){return[this._value,this._valueShallow,this._valueRef,this._forceReactionToggle][this._observableKind]}_setObservable(t){this._getObservable(),n.transaction(()=>{const e=this._prepareValueToObserve(t,this._name);"ref"===e.observable?(this._value=void 0,this._valueShallow=void 0,this._valueRef=e.value,this._observableKind=2):"shallow"===e.observable?(this._value=void 0,this._valueRef=void 0,this._valueShallow=e.value,this._observableKind=1):(this._valueShallow=void 0,this._valueRef=void 0,this._value=e.value,this._observableKind=0)})}_prepareObjectToObserve(t){if(n.isObservable(t)){return{value:t,observable:"ref"}}const e=Object.keys(t).reduce((e,i)=>{if(n.isObservableProp(t,i)){return e}const s=this._prepareValueToObserve(t[i],i);return t[i]=s.value,"ref"===s.observable?e[i]=n.observable.ref:"shallow"===s.observable?e[i]=n.observable.shallow:e[i]=n.observable.deep,e},{});return{value:n.observable(t,e),observable:"ref"}}_prepareValueToObserve(e,i){if(Z(e)){return{value:e,observable:"ref"}}if(d(e)||m(e)){return{value:e,observable:"shallow"}}if(function(t){return t instanceof Element}(e)||Q(e)||Y(e)){return{value:e,observable:"ref"}}if(l(e)){if(S(i)&&!B._isWrappedView(e)){const i=s.observer(e),n=e=>t(i,{...e});n.__ueca_ViewFn=e,e=n}return{value:e,observable:"ref"}}return _(e)?this._prepareObjectToObserve(e):{value:e,observable:"deep"}}static _isEqual(t,e){return Q(t)||Q(e)||Y(t)||Y(e)||Z(t)||Z(e)?t===e:l(t)||l(e)?(B._isWrappedView(t)&&(t=t.__ueca_ViewFn),B._isWrappedView(e)&&(e=e.__ueca_ViewFn),t===e):g(t,e)}static _isWrappedView(t){return l(t)&&Reflect.has(t,"__ueca_ViewFn")}}class E extends I{child;constructor(t,e,i){super(t,e),n.makeObservable(this,{child:n.observable.ref}),this.child=i}}class T extends I{method;constructor(e,i,n){if(super(e,i),S(i)){const e=s.observer(n);this.method=i=>t(e,{...i})}else{this.method=n}}}class V extends I{_event;constructor(t,e){super(t,e),n.makeObservable(this,{_event:n.observable.ref})}get event(){const t=this._target.$.__struct.events?.[this._name];return!t||x(this._name,this._target.$.__struct)||function(t,e){if("onPropChange"===t){return!0}if(!t.startsWith("onChange")){return!1}let i=t.substring(8);return i=i[0].toLowerCase()+i.slice(1),!!Reflect.has(e.props,i)}(this._name,this._target.$.__struct)?this._event:async(...e)=>{const i=this._target.$.__status.baseResult;try{let i=await t(...e);return this._event&&(this._target.$.__status.baseResult=i,i=await this._event(...e)),i}finally{this._target.$.__status.baseResult=i}}}set event(t){this._event=t}}function S(t){return t?.endsWith("View")}function x(t,e){if("onPropChanging"===t){return!0}if(!t.startsWith("onChanging")){return!1}let i=t.substring(10);return i=i[0].toLowerCase()+i.slice(1),!!Reflect.has(e.props,i)}class D{_registry;name;constructor(t){this.name=t,this._registry=new Map}subscribe(t){const e=t.$.__struct.messages;e&&Object.keys(e).forEach(e=>{let i=this._registry.get(e);i||(i=new Set,this._registry.set(e,i)),i.add(t)})}unsubscribe(t){const e=t.$.__struct.messages;if(!e){return}const i=[];Object.keys(e).forEach(e=>{const n=this._registry.get(e);n&&(n.delete(t),n.size||i.push(e))}),i.forEach(t=>{this._registry.delete(t)})}async broadcast(t,e,i){const n=this._registry.get(e);if(!n||!n.size){return ot(`MessageBus (${this.name}): no subscribers for message "${e}"`,"warn"),[]}const s=[];for(const r of n){if(a(t)||o(t)||""===t){}else if(c(t)){if(t&&r.fullId()!=t){continue}}else{if(!(t instanceof RegExp)){break}if(!t.test(r.fullId())){continue}}const n=r.$.__struct.messages?.[e];if(n){const t=n(i);s.push(t)}}return await Promise.all(s)}async castTo(t,e,i){const n=await this.broadcast(t,e,i);return n?.length>1&&ot(`MessageBus (${this.name}): Ambiguous unicast by message "${e}"`,"warn"),n?n[0]:void 0}async unicast(t,e){return await this.castTo("",t,e)}async getAsync(t,e){return await this.unicast(t,e)}async postAsync(t,e){return await this.unicast(t,e)}}const j=function(){const t=new D("Default Message Bus");return window.addEventListener("messagebus.post",function(e){t.broadcast(null,e.detail.message,e.detail.params)}),t}(),A=i.createContext(j);function L(){return j}function N(t){return function(t,e){return i.useEffect(()=>(t.subscribe(e),()=>t.unsubscribe(e)),[]),t}(i.useContext(A),t)}n._getGlobalState().allowStateChanges=!0;class z{_privateMembers;_birthMark;_disableOnChangeCount=0;_bus;_renderToggle;constructor(t){n.makeObservable(this,{_renderToggle:n.observable,View:n.computed,BaseView:n.computed,clearModelCache:n.action,invalidateView:n.action,_assignParams:n.action,_constr:n.action,_init:n.action,_mount:n.action,_unmount:n.action,_deinit:n.action,_draw:n.action,_erase:n.action,_deleteMember:n.action}),z._checkUniqueNamesInStructSections(t),this._privateMembers={__status:{initPhase:void 0,mountPhase:void 0,cached:!1,initCount:0,mountCount:0,baseResult:void 0},__struct:void 0,__params:void 0,__owner:void 0,__dynamicChildrenIds:[],__staticChildrenCache:void 0,__proxy:void 0,__settersInProgress:[],__assignParams:void 0,__initializeModel:void 0},t={...t},this._birthMark=Math.round(1e6*Math.random()).toString(),this.$.__struct=t,this.$.__dynamicChildrenIds=[],this.$.__staticChildrenCache=[],this.$.__settersInProgress=[],this.$.__assignParams=this._assignParams.bind(this),this.$.__initializeModel=this._initializeModel.bind(this);for(const e in t.props){if(e.startsWith("__")){this[e]=t.props[e],delete t.props[e];continue}const i=new B(this,e),n=t.props[e];l(n)&&(t.props[e]=P(n,void 0)),k(t.props[e])?S(e)?i.value=J:i.value=void 0:i.value=t.props[e],this[e]=i}for(const e in t.children){const i=new E(this,e,t.children[e]);i.child.$.__owner=this,i.child.disableOnChange(),i.child.id=e,i.child.enableOnChange(),this[e]=i}for(const e in t.methods){const i=t.methods[e];this[e]=new T(this,e,i)}for(const e in t.events){if(e.startsWith("onChanging")||e.startsWith("onChange")||"onPropChanging"===e||"onPropChange"===e){return}this[e]=new V(this,e)}this._renderToggle=void 0}get $(){return this._privateMembers}get bus(){return this._bus}get View(){return this._view()}get BaseView(){return this._view(!0)}disableOnChange(){this._disableOnChangeCount++}enableOnChange(){if(0===this._disableOnChangeCount){throw new Error("enableOnChange() requires disableOnChange() pair")}this._disableOnChangeCount--}changeNotifyDisabled(){return this._disableOnChangeCount>0}birthMark(){return this._birthMark}fullId(){let t="";return this.$.__owner&&(t=this.$.__owner.fullId()+"."),t+(this.id?.value??"<empty>")}htmlId(){const t=this.fullId();return"<empty>"===t?void 0:window.hashHtmlId?z._getHashCode(t):t}getChildrenModels(t){const e=[];if(!t||"static"===t){for(const i in this.$.__struct.children){e.push(this.$.__proxy[i])}}return t&&"dynamic"!==t||this.$.__dynamicChildrenIds.forEach(t=>e.push(this.$.__proxy[t])),e}clearModelCache(){for(const t of this.$.__dynamicChildrenIds){const e=this.$.__proxy[t];if(e&&(ot(`uncache dynamic model=#${e.birthMark()} path=${e.htmlId()} cache=#${this.birthMark()}`),this._deleteMember(t),e.$.__status.cached=!1,e.$.__staticChildrenCache.length)){for(const t of e.$.__staticChildrenCache){if(!t){return}ot(`uncache static model=#${t.birthMark()} path=${t.htmlId()} cache=#${e.birthMark}`),t.$.__status.cached=!1}for(const t of e.$.__staticChildrenCache){if(!t){return}t.clearModelCache()}this.$.__staticChildrenCache.splice(0)}}this.$.__dynamicChildrenIds.splice(0)}invalidateView(){this._renderToggle=!this._renderToggle}_view(e=!1){const n=s.observer((n=>{const s=!a(this._renderToggle)&&(a(n?.render)||n.render),r=s?this.$.__proxy:void 0;s&&this.$.__status.mountCount++,i.useEffect(()=>(s&&a(this.$.__status.mountPhase)&&this._mount(),()=>{s&&this.$.__status.mountCount--,this.$.__status.mountCount||this._unmount()}));const o=t=>{const s=e?r?.$.__struct.BaseView:r?.$.__struct.View;return i.useLayoutEffect(()=>{if(t&&s){return this._draw(),()=>{this._erase()}}}),t&&s?(ot(`render view model=#${r?.birthMark()} path=${r?.htmlId()}`),s(n)):null};return s?t(W,{componentModel:r,children:t(it.Provider,{value:et(r),children:o(!0)})}):o(!1)}).bind(this));return e=>t(n,{...e})}_assignParams(t){delete(t={...t}).cacheable;for(const e in this.$.__struct.props){if(l(t[e])&&Reflect.has(t,e)){const i=t[e];t[e]=P(i,void 0)}}this.$.__params=t;for(const e in t){"constr"===e||"init"===e||"deinit"===e||"mount"===e||"unmount"===e||"draw"===e||"erase"===e||k(t[e])||(this.$.__proxy[e]=t[e])}}_initBindings(){for(const t in this.$.__struct.props){this[t]?.initBindings()}}_deInitBindings(){for(const t in this.$.__struct.props){this[t]?.deinitBindings()}}async _constr(){this.$.__status.initPhase="constructing";try{const t=this.$.__proxy;ot(`constr model=#${t.birthMark()} path=${t.htmlId()}`),await(this.$.__struct.constr?.(this.$.__proxy)),await(this.$.__params?.constr?.(this.$.__proxy))}finally{this.$.__status.initPhase="constructed"}}async _init(t){if(this.$.__status.initPhase||await this._constr(),this._assignParams(t),"constructed"===this.$.__status.initPhase){this.$.__status.initPhase="initializing";try{const t=this.$.__proxy;ot(`init model=#${t.birthMark()} path=${t.htmlId()}`),this._initBindings(),await(this.$.__struct.init?.(t)),await(this.$.__params?.init?.(t))}finally{this.$.__status.initPhase="initialized";try{"init-mount"===this.$.__status.mountPhase&&await this._mount()}finally{a(this._renderToggle)&&this.invalidateView()}}}}async _mount(){if("mounted"===this.$.__status.mountPhase){return}if("initialized"!=this.$.__status.initPhase){return void(this.$.__status.mountPhase="init-mount")}this.$.__status.mountPhase="mounting";const t=this.$.__proxy;ot(`mount model=#${t.birthMark()} path=${t.htmlId()}`),await(this.$.__struct.mount?.(t)),await(this.$.__params?.mount?.(t)),this.$.__status.mountPhase="mounted"}async _unmount(){if("mounted"==this.$.__status.mountPhase){this.$.__status.mountPhase="unmounting";try{const t=this.$.__proxy;ot(`unmount model=#${t.birthMark()} path=${t.htmlId()}`),await(this.$.__params?.unmount?.(t)),await(this.$.__struct.unmount?.(t))}finally{this.$.__status.mountPhase=void 0,"unmount-deinit"===this.$.__status.initPhase&&(this.$.__status.initPhase="initialized",await this._deinit())}}}async _deinit(){if(this.$.__status.initCount--,!this.$.__status.initCount&&"initialized"===this.$.__status.initPhase){if("mounted"===this.$.__status.mountPhase||"unmounting"===this.$.__status.mountPhase){return this.$.__status.initCount++,void(this.$.__status.initPhase="unmount-deinit")}this.$.__status.initPhase="deinitializing";try{const t=this.$.__proxy;ot(`deinit model=#${t.birthMark()} path=${t.htmlId()}`),this._renderToggle=void 0,await(this.$.__params?.deinit?.(t)),await(this.$.__struct.deinit?.(t)),this._deInitBindings()}finally{this.$.__status.initPhase="constructed"}}}async _draw(){const t=this.$.__proxy;await(this.$.__struct.draw?.(t)),await(this.$.__params?.draw?.(t))}async _erase(){const t=this.$.__proxy;await(this.$.__params?.erase?.(t)),await(this.$.__struct.erase?.(t))}_deleteMember(t){let e=!1;return Reflect.has(this,t)&&(delete this[t],e=!0),Reflect.has(this,t)&&(delete this[t],e=!0),e}_initializeModel(t){this.$.__status.initCount++,this._bus=N(this),i.useEffect(()=>(this._init(t),()=>{this._deinit()}))}static _getHashCode(t){let e="";const i=Array.from(t).reduce((t,e)=>Math.imul(31,t)+e.charCodeAt(0)|0,0);for(let n=0;n<32;n+=6){e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_-".charAt(i>>>n&63)}return e}static _checkUniqueNamesInStructSections(t){const e=f(Object.keys(t.props??{}),Object.keys(t.children??{}));if(e.concat(f(Object.keys(t.props??{}),Object.keys(t.methods??{}))),e.concat(f(Object.keys(t.props??{}),Object.keys(t.events??{}))),e.concat(f(Object.keys(t.children??{}),Object.keys(t.methods??{}))),e.concat(f(Object.keys(t.children??{}),Object.keys(t.events??{}))),e.concat(f(Object.keys(t.methods??{}),Object.keys(t.events??{}))),e.length>0){throw new Error(`The component structure${t.props?.id?" "+t.props.id+" ":""}contains not unique members: ${e}`)}}}class W extends i.PureComponent{_retryStarted=!1;_retriesLeft;constructor(t){super(t),this.state={renderingFailed:!1},this._retriesLeft=t.maxRenderRetries,a(this._retriesLeft)&&(this._retriesLeft=1)}static getDerivedStateFromError(t){return{renderingFailed:!0,error:t}}componentDidCatch(t){0===this._retriesLeft&&(this.props.componentModel&&ot(`JSX Rendering Error model=#${this.props.componentModel.birthMark()} path=${this.props.componentModel.htmlId()}\n${t}`,"error"),this.props?.onRenderError?.(t))}render(){if(!this.state.renderingFailed){
return t(e,{children:$(this.props.children)})}let i=null;return this._retriesLeft>0?this._retryStarted||(setTimeout(()=>{this._retriesLeft--,this._retryStarted=!1,this.setState({renderingFailed:!1})}),this._retryStarted=!0):at.traceLog&&(i=t("div",{style:{display:"flex",placeContent:"center",fontSize:"large",minWidth:"fit-content",minHeight:"fit-content",overflow:"overlay",backgroundColor:"red",color:"yellow"},title:this._getErrorTitleInfo(),children:"⚠"})),i}_getErrorTitleInfo(){let t="";return this.props.description&&(t=`${t}• Description\n${this.props.description}\n\n`),this.props.componentModel&&(t=`${t}• UECA Component\nmodel: #${this.props.componentModel.birthMark()}\npath:  ${this.props.componentModel.htmlId()}\n\n`),this.state.error&&(t=`${t}• Error Details\n${this.state.error?.message}`),`JSX RENDERING ERROR\n\n${t}`}}class F{constructor(t){const e=new z(t),i=new Proxy(e,{get:F._get,set:F._set});return e.$.__proxy=i,i}static _get(t,e){if(p(e)&&e===U||e===q){return t[q]}let i=t[e];return i instanceof B?i=i.value:i instanceof T?i=i.method:i instanceof V?i=i.event:i instanceof E?i=i.child:l(i)&&(i=i.bind(t)),i}static _set(t,e,i){if(p(e)||e===q){return!1}if(-1!==t.$.__settersInProgress.indexOf(e)){return!0}t.$.__settersInProgress.push(e);try{if(t[e]instanceof B){t[e].value=i}else if(t[e]instanceof V){a(i)||l(i)?t[e].event=i:console.error(`Attempt to assign non-function value to event "${e}"`)}else if(l(i)){const n=new V(t,e);n.event=i,t[e]=n}else{if(t[e]instanceof T||t[e]instanceof E){return!1}t[e]=i}}finally{t.$.__settersInProgress.pop()}return!0}}const H=i.version.startsWith("19."),q="$",U=Symbol(q),J=()=>t(e,{});function K(t,e,i,n){n||(n=G);const s=n(function(t,e,i){e||(e={});const n={props:{...t.props,...e.props},children:{...t.children,...e.children},methods:{...t.methods,...e.methods},events:{...t.events,...e.events},messages:{...t.messages,...e.messages},View:e.View&&e.View!==J?e.View:t.View?t.View:J,BaseView:t.View??J};if(t.methods&&e.methods){for(const s in n.methods){Reflect.has(t.methods,s)&&Reflect.has(e.methods,s)&&(n.methods[s]=async(...n)=>{const r=i(),a=r.$.__status.baseResult;try{r.$.__status.baseResult=await t.methods[s](...n),await e.methods[s](...n)}finally{r.$.__status.baseResult=a}})}}if(t.events&&e.events){for(const s in n.events){if(Reflect.has(t.events,s)&&Reflect.has(e.events,s)){let r;r="onPropChanging"===s?(i,n,r)=>(n=t.events[s](i,n,r),e.events[s](i,n,r)):x(s,n)?(i,n)=>(i=t.events[s](i,n),e.events[s](i,n)):async(...n)=>{const r=i(),a=r.$.__status.baseResult;try{let i=await t.events[s](...n);return r.$.__status.baseResult=i,i=await e.events[s](...n),i}finally{r.$.__status.baseResult=a}},n.events[s]=r}}}return n.constr=e?.constr?async()=>{await(t.constr?.(i())),await(e.constr?.(i()))}:t.constr,n.init=e?.init?async()=>{await(t.init?.(i())),await(e.init?.(i()))}:t.init,n.deinit=e?.deinit?async()=>{await(e.deinit?.(i())),await(t.deinit?.(i()))}:t.deinit,n.mount=e?.mount?async()=>{await(t.mount?.(i())),await(e.mount?.(i()))}:t.mount,n.unmount=e?.unmount?async()=>{await(e.unmount?.(i())),await(t.unmount?.(i()))}:t.unmount,n.draw=e?.draw?async()=>{await(t.draw?.(i())),await(e.draw?.(i()))}:t.draw,n.erase=e?.erase?async()=>{await(e.erase?.(i())),await(t.erase?.(i()))}:t.erase,n}(t,e,()=>s),i);return s}function G(t,e){const n=nt();let s=!0;const[r]=i.useState(()=>(s=!1,function(){const i=function(){if("no-cache"==at.modelCacheMode){return!1}let i;return a(e?.cacheable)||(k(e.cacheable)?ot('Bindings are not permitted for the property "cacheable"',"error"):i=e.cacheable),a(i)&&!a(t.props?.cacheable)&&(k(t.props.cacheable)?ot('Bindings are not permitted for the property "cacheable"',"error"):i=t.props.cacheable),a(i)&&"auto-cache"==at.modelCacheMode&&(i=!0),!!i}();let s=n?.staticModelsTrap?.getNextCachedModel();const r=null===s;return s?n.staticModelsTrap&&s!=n.staticModelsTrap.owner&&(ot(`use cached static model=#${s.birthMark()} path=${s.htmlId()} cache=#${n.staticModelsTrap.owner?.birthMark()}`),s.cacheable&&ot(`remove cached static model=#${s.birthMark()} path=${s.htmlId()} cache=#${n.staticModelsTrap.owner?.birthMark()}`)):(w(!t.props),t.props.cacheable=i,s=function(t,e){const i=new F(t);return i.$.__assignParams(e),i}(t,e??{}),ot(`create model=#${s.birthMark()} path=${s.htmlId()}`),s.fullId()||ot("Set a default id in the struct of the component model hook","warn"),n?.staticModelsTrap&&i&&(n.staticModelsTrap.cacheModel(i?s:null,r),r&&ot(`recache static model=#${s.birthMark()} path=${s.htmlId()} cache=#${n.staticModelsTrap.owner?.birthMark()}`))),s}()));if(!r){throw Error("BUG: Component model is undefined")}return s&&ot(`use React cached model=#${r.birthMark()} path=${r.htmlId()} cache=React.useState()`),r.$.__initializeModel(e),r}function X(t){return Z(t)?`[model #${t.birthMark()}]`:R(t)?"[binding_rw]":function(t){return k(t)&&a(t[1])}(t)?"[binding_ro]":Q(t)?"[jsx]":Y(t)?`[()=>jsx${t.displayName?" "+t.displayName:""}]`:d(t)?`[array ${t.length}]`:l(t)?`[funct${t.name?" "+t.name:""}]`:_(t)?"[object]":c(t)?t.length>32?`"${t.substring(0,31)}... [${t.length}]"`:`"${t}"`:t}function Q(t){return H?i.isValidElement(t):p(t?.$$typeof)&&"react.element"===t.$$typeof.description}function Y(t){return p(t?.$$typeof)&&"react.memo"===t.$$typeof.description}function Z(t){return _(t)&&Reflect.has(t,q)&&_(t[q])&&Reflect.has(t,"birthMark")&&l(t.birthMark)&&Reflect.has(t,"fullId")&&l(t.fullId)&&Reflect.has(t,"htmlId")&&l(t.htmlId)}function tt(t){return t.replace(/^./,t[0].toUpperCase())}function et(t){const e={owner:t,cacheModel:t=>{if(!t.id){return void ot(`Can't cache dynamic model=#${t.birthMark()}, "id" is empty.`,"error")}if(t.$.__owner&&t.$.__owner!==e.owner){return void ot(`Can't cache dynamic model=#${t.birthMark()} because it belongs to other model=#${t.$.__owner.birthMark()}`,"error")}const i=e.getCachedModel(t.id);if(i){return void(i!=t&&ot(`Can't cache dynamic model=#${t.birthMark()}. Id "${t.id}" already in cache=#${e.owner.birthMark()}.`,"error"))}t.$.__owner||(t.$.__owner=e.owner);const n=e.owner;if(n[t.id]){n[t.id]!==t&&ot(`Can't cache dynamic model=#${t.birthMark()}. Id "${t.id}" already exists in cache=#${e.owner.birthMark()}.`,"error")}else if(t.$.__struct.props.cacheable){if(-1!=e.owner.$.__dynamicChildrenIds.indexOf(t.id)){throw Error(`Can't cache dynamic model=#${t.birthMark()} in cache=#${t.$.__owner.birthMark()}. Id "${t.id}" already registered.`)}ot(`cache dynamic model=#${t.birthMark()} path=${t.htmlId()} cache=#${e.owner.birthMark()}`),n[t.id]=t,e.owner.$.__dynamicChildrenIds.push(t.id),t.$.__status.cached=!0}},getCachedModel:t=>{const i=e.owner[t];if(i&&!i.$.__status.cached){throw Error("Dynamic cache corrution")}return i}};return e}const it=i.createContext(void 0);function nt(){return i.useContext(it)}function st(t){const e={models:t,pointer:-1,getNextCachedModel:()=>{if(e.pointer===e.models.length-1){return}if(e.pointer++,!e.models[e.pointer]){return}const t=e.models[e.pointer];if(!t.$.__status.cached){throw Error("Static cache corrution")}return t.cacheable||(e.models[e.pointer]=null,t.$.__status.cached=!1),t},cacheModel:(t,i)=>{if(i){if(e.pointer>=0&&e.pointer<e.models.length){const i=e.models[e.pointer];i&&(i.$.__status.cached=!1,i.cacheable=!1),e.models[e.pointer]=t}}else{e.models.push(t),e.pointer++}t&&(t.$.__status.cached=!0)}};return e}function rt(t){return e=>{ot(`FC begin hook=${t.name}`);const i=nt();let n;if(i){if(i.staticModelsTrap){throw Error(`Hook "${t.name}" called recursively.`)}c(e.id)&&e.id?(n=i.getCachedModel(e.id),n?(i.staticModelsTrap=st(n.$.__staticChildrenCache),i.staticModelsTrap.owner=n,ot(`use cached dynamic model=#${n.birthMark()} path=${n.htmlId()} cache=#${i.owner.birthMark()}`)):i.staticModelsTrap=st([])):(i.staticModelsTrap=st([]),ot('Set property "id" in JSX for caching the model by the parent component.',"warn"))}const s=t(e);let r=!1;if(n){if(n!=s){throw Error("The cached models don't match")}r=!0}else{n=s,e.id||n.id!==t.name||(n.id=void 0),i&&n.id&&n.id===e.id&&(r=i.getCachedModel(n.id)===n,!r&&n.cacheable&&i.cacheModel(n))}if(i?.staticModelsTrap){if(n.$.__staticChildrenCache.length&&i.staticModelsTrap.models.length&&n.$.__staticChildrenCache!=i.staticModelsTrap.models){throw Error("something's wrong")}e.id&&!r&&(n.$.__staticChildrenCache=i.staticModelsTrap.models,at.traceLog&&n.$.__staticChildrenCache.forEach(t=>{t&&(t.$.__owner||(t.$.__owner=n),ot(`cache static model=#${t.birthMark()} path=${t.htmlId()} cache=#${n.birthMark()}`))})),i.staticModelsTrap=void 0}return ot(`FC end hook=${t.name}`),n.View()}}i.createContext(void 0),window.addEventListener("unhandledrejection",t=>{at.errorHandler&&(t.preventDefault(),at.errorHandler(t.reason))}),window.addEventListener("error",t=>{at.errorHandler&&(t.preventDefault(),at.errorHandler(t.error))});const at={traceLog:!1,hashHtmlId:!1,modelCacheMode:"auto-cache"};function ot(t,e="info"){if(at.traceLog){switch(e){case"warn":console.warn(t);break;case"error":console.error(t);break;default:console.debug(t)}}}window.UECA=at;export{U as $,q as $name,b as IF,v as RenderNode,P as bind,O as bindProp,r as clone,L as defaultMessageBus,w as errorIf,y as errorIfNot,rt as getFC,at as globalSettings,f as intersection,d as isArray,u as isBoolean,Z as isComponentModel,g as isEqual,l as isFunction,m as isMap,o as isNull,h as isNumber,_ as isObject,c as isString,p as isSymbol,a as isUndefined,M as observe,$ as renderNode,C as sleep,G as useComponent,K as useExtendedComponent,N as useMessaging};
